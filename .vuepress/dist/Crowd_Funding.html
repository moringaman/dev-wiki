<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Solidity Contract - Crowd Funding Example | Dev Docs</title>
    <meta name="description" content="Webnostix Dev Wiki">
    
    
    <link rel="preload" href="/assets/css/0.styles.fba42894.css" as="style"><link rel="preload" href="/assets/js/app.7b0e0db7.js" as="script"><link rel="preload" href="/assets/js/12.555976f6.js" as="script"><link rel="prefetch" href="/assets/js/8.edec09dd.js"><link rel="prefetch" href="/assets/js/1.df57bade.js"><link rel="prefetch" href="/assets/js/2.11bd27e5.js"><link rel="prefetch" href="/assets/js/3.5e0d254a.js"><link rel="prefetch" href="/assets/js/4.36430e0f.js"><link rel="prefetch" href="/assets/js/5.2ada5031.js"><link rel="prefetch" href="/assets/js/6.c757fc29.js"><link rel="prefetch" href="/assets/js/7.061f02cb.js"><link rel="prefetch" href="/assets/js/9.592aa277.js"><link rel="prefetch" href="/assets/js/10.8baef762.js"><link rel="prefetch" href="/assets/js/11.38a3c60c.js"><link rel="prefetch" href="/assets/js/13.3da75c72.js"><link rel="prefetch" href="/assets/js/14.403700d1.js"><link rel="prefetch" href="/assets/js/15.b3d34ee7.js"><link rel="prefetch" href="/assets/js/16.9eea055d.js"><link rel="prefetch" href="/assets/js/17.06fb27f2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fba42894.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Dev Docs
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Javascript.html" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Dev-Ops.html" class="nav-link">Dev-Ops</a></div><div class="nav-item"><a href="/Blockchain.html" class="nav-link">BlockChain</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Javascript.html" class="nav-link">Javascript</a></div><div class="nav-item"><a href="/Dev-Ops.html" class="nav-link">Dev-Ops</a></div><div class="nav-item"><a href="/Blockchain.html" class="nav-link">BlockChain</a></div><!----></nav><!----></div><div class="page"><div class="content"><h1 id="solidity-contract-crowd-funding-example"><a href="#solidity-contract-crowd-funding-example" aria-hidden="true" class="header-anchor">#</a> Solidity Contract - Crowd Funding Example</h1><h4 id="the-campaign-factory"><a href="#the-campaign-factory" aria-hidden="true" class="header-anchor">#</a> The Campaign Factory</h4><p>Create a campaign factory which is an initial campaign which can be called by various ethereum accouns to spawn instances of the main Campaign contract.</p><div class="language-js extra-class"><pre class="language-js"><code>
contract CampaignFactory <span class="token punctuation">{</span>
    address<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">public</span> deployedCampaigns<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">createCampaign</span><span class="token punctuation">(</span>uint minimum<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        address newCampaign <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Campaign</span><span class="token punctuation">(</span>minimum<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
        deployedCampaigns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newCampaign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">function</span> <span class="token function">getDeployedCampaigns</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> view <span class="token function">returns</span> <span class="token punctuation">(</span>address<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> deployedCampaigns<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><ol><li><p>Create an address array or (<strong>array of type address</strong>) to store all campaign addresses deployed by our factory.  <code>address[] public deployedCampaigns</code></p></li><li><p>Create a createCampaign function which takes a minimum contribution value as an unsigned integer ahd creates a new campaign by calling the Campaign contract and passing in the minimum amount and the account that created it as the msg.sender.</p></li><li><p>finally add the address of the new Campaign contract to the array of deployed campaigns.</p></li></ol><h4 id="note"><a href="#note" aria-hidden="true" class="header-anchor">#</a> NOTE</h4><p>This campaign also has a <strong>getDeployedCampaigns</strong> function which can be used to query all contracts that it has created.</p><h3 id="the-campaign"><a href="#the-campaign" aria-hidden="true" class="header-anchor">#</a> The Campaign</h3><ol><li>First our Campaign contract is instantiated with the following campaign function which has the same name as our campaign and is executed automatically</li></ol><p><code>contract Campaign { ... }</code></p><ol start="2"><li>and the two parameters that are passed to it by the factory are declared as <strong>public</strong> variables</li></ol><p><code>address public manager</code> &amp; <code>uint public minimumContribution</code></p><ol start="3"><li>Next we set up our contract with the main contract function which takes our two values as follows</li></ol><div class="language-js extra-class"><pre class="language-js"><code>
    <span class="token keyword">function</span> <span class="token function">Campaign</span><span class="token punctuation">(</span>uint minimum<span class="token punctuation">,</span> address creator<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        manager <span class="token operator">=</span> creator<span class="token punctuation">;</span>
        minimumContribution <span class="token operator">=</span> minimum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre></div><ol><li><p>This establishes the campaign manager as the creator or Ethereum account that created it as well as establishing the minimum contribution for anyone wishing to contribute to the campaign.</p></li><li><p>Now in order to create a request we need to declare a struct (or data structure) type that we will use for each request that will be later pushed into an array of requests, see below;</p></li></ol><div class="language-js extra-class"><pre class="language-js"><code>
struct Request <span class="token punctuation">{</span>
  string description<span class="token punctuation">;</span>
  uint value<span class="token punctuation">;</span>
  address recipient<span class="token punctuation">;</span>
  bool complete<span class="token punctuation">;</span>
  uint approvalCount<span class="token punctuation">;</span>
  <span class="token function">mapping</span><span class="token punctuation">(</span>address <span class="token operator">=&gt;</span> bool<span class="token punctuation">)</span> approvals<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>You can see from the above struct that we also have a mapping which will holds all the addresses of our approvers as a key mapped to a boolean denoting whether it has been approved by that account or not.</p><h3 id="campaign-contributions"><a href="#campaign-contributions" aria-hidden="true" class="header-anchor">#</a> Campaign Contributions</h3><ol><li>In order for us to allow people to contribute to our campaign contract we need to create a <strong>Payable</strong> function called contribute. This function will chack that the amount sent or <strong>msg.value</strong> is greater than our minimumContribution.</li></ol><p><code>require(msg.value &gt; minimumContribution)</code></p><ol><li>We are also going to add the contributors wallet address to the list of campaign approvers (<strong>people who can approve requests</strong>). To do this we need to create a mapping called approvers that maps their address to a boolian value. see below:</li></ol><p><code>mapping (address =&gt; bool) public approvers;</code></p><ol start="2"><li>So once we have checked that  the contribution amount is enough we will map the address to true in our approvers mappings with:</li></ol><p><code>approvers[msg.sender] = true;</code></p><ol start="3"><li>lastly we need to increment an approversCount variable by one to keep track of how many approvers/contributers we have with</li></ol><p><code>approversCount++</code></p><div class="language-js extra-class"><pre class="language-js"><code>   <span class="token keyword">function</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> payable <span class="token punctuation">{</span>
     <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> minimumContribution<span class="token punctuation">)</span><span class="token punctuation">;</span>
     approvers<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
     approvalCount<span class="token operator">++</span>
   <span class="token punctuation">}</span>

</code></pre></div><p>The fact that the function is <strong>payable</strong> means that it is able to accept <strong>ether</strong> to be added to <code>this.balance</code> or the contract balance.</p><h4 id="requests"><a href="#requests" aria-hidden="true" class="header-anchor">#</a> Requests</h4><ol start="6"><li>Before we can create a request we need to declare an empty array of our Request structure data-type called requests, we do that using the following statement;</li></ol><p><code>Request[] public requests; // our public keyword will automatically create a getter for our array</code></p><ol start="7"><li>Now we can use our createRequests  function which will take all our request parameters and populate a Request struct object to be pushed to our requests array.</li></ol><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">createRequest</span><span class="token punctuation">(</span>string description<span class="token punctuation">,</span> uint value<span class="token punctuation">,</span>
		address recipient<span class="token punctuation">)</span> <span class="token keyword">public</span> restricted <span class="token punctuation">{</span>
  Request memory newRequest <span class="token operator">=</span> <span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    description<span class="token punctuation">:</span> description<span class="token punctuation">;</span>
    value<span class="token punctuation">:</span> value<span class="token punctuation">;</span>
    recipient<span class="token punctuation">:</span> recipient<span class="token punctuation">;</span>
    complete<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    approvalCount<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  requests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><ol><li><p>The above function is public so that it can called externally also we create an instance of the Request struct called newRequest as a pointer with the memory keyword. This temporary object is then pushed onto our empty array requests</p></li><li><p>You'll also notice that the createRequest function is marked restricted. This is because we are using a modifier that ensures that only the campaign creator or manager can run it.</p></li></ol><div class="language-js extra-class"><pre class="language-js"><code>
modifier <span class="token function">restricted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> manager<span class="token punctuation">)</span><span class="token punctuation">;</span>
  _<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="request-approvals"><a href="#request-approvals" aria-hidden="true" class="header-anchor">#</a> Request Approvals</h4><ol><li>In our approveRequest function we are going to select a request by it's index from our array of Request objects (or Structs) called requests create some storage for it in order to update it's approvals membership and icrement the approval count.</li></ol><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">approveRequest</span><span class="token punctuation">(</span>uint index<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
  Request storage request <span class="token operator">=</span> requests<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><ol><li><p>Next we need to make sure that first the approver is one of our campaign approvers with:</p><p><code>require(approvers[msg.sender]); // is this a truthy value</code></p></li><li><p>We also need to make sure that they have not already approved our selected request with.</p><p><code>require(!request.approvals[msg.sender]); // are they in the request Structs approvals mapping?</code></p></li><li><p>Finally we need to add the sender to the request Structs approval mapping and increment the requests approval count with:</p><p><code>request.approvals[msg.sender] = true;</code></p><p><code>request.approvalCount++</code></p></li><li><p>So our final function looks like:-</p></li></ol><div class="language-js extra-class"><pre class="language-js"><code>
   <span class="token keyword">function</span> <span class="token function">approveRequest</span><span class="token punctuation">(</span>iuint index<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
     Request storage request <span class="token operator">=</span> requests<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token function">require</span><span class="token punctuation">(</span>approvers<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">require</span><span class="token punctuation">(</span><span class="token operator">!</span>requests<span class="token punctuation">.</span>approvals<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     
     requests<span class="token punctuation">.</span>approvals<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
     requests<span class="token punctuation">.</span>approvalCount<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

</code></pre></div><h3 id="finalizing-requests"><a href="#finalizing-requests" aria-hidden="true" class="header-anchor">#</a> Finalizing Requests</h3><ol><li><p>In order to finalize a request which results in the funds being sent to the suppliers wallet we first create a public function which utilizes the
restricted modifier and accepts the index of the request to be finalized.</p></li><li><p>Next we need to create a place in memory called request and set it equal to requests array at the index provided</p></li><li><p>Thirdly we need to check that most of our approvers have given their approval this is done by checking that our approcal count is<br>
greater that half of approversCount. We also make sure that the request has not already been completed.</p></li></ol><div class="language-js extra-class"><pre class="language-js"><code>
    <span class="token keyword">function</span> <span class="token function">finalizeRequest</span><span class="token punctuation">(</span>uint index<span class="token punctuation">)</span> <span class="token keyword">public</span> restricted <span class="token punctuation">{</span>
        Request storage request <span class="token operator">=</span> requests<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token function">require</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>approvalCount <span class="token operator">&gt;</span> <span class="token punctuation">(</span>approversCount <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>complete<span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span>recipient<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span>complete <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
</code></pre></div><ol start="4"><li>finally we transfer the value to the requests recipient and mark the request as completed.</li></ol></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/assets/js/12.555976f6.js" defer></script><script src="/assets/js/app.7b0e0db7.js" defer></script>
  </body>
</html>
